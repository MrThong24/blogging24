"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[299],{2299:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});var r=n(1413),a=n(5861),s=n(9439),i=n(7757),o=n.n(i),c=n(4167),u=n(5456),l=n(9501),d=n(9248),p=n(3031),h=n(3117),f=n(6848),m=n(4961),g=n(1199),x=n(9062),v=n(1776),b=n(8322),j=n(2791),k=n(1134),y=n(3504),_=n(3585),E=n(6770),w=n.n(E),S=(n(6009),n(577)),Z=n(8113),N=n(4569),C=n.n(N),D="https://api.imgbb.com/1/upload?key=".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_IMGBB_KEY),I=n(333),T=n.n(I),P=n(9808),U=n(1830),A=n.n(U),O=n(184);E.Quill.register("modules/imageUploader",Z.Z);var R=function(){var e=(0,P.a)().userInfo,t=(0,y.lr)(),n=(0,s.Z)(t,1)[0].get("id"),i=(0,j.useState)(""),E=(0,s.Z)(i,2),Z=E[0],N=E[1],I=(0,k.cI)({mode:"onChange"}),U=I.handleSubmit,R=I.control,L=I.setValue,F=I.watch,J=I.reset,Y=I.getValues,V=I.formState,K=V.isValid,M=V.isSubmitting,B=Y("image"),G=Y("image_name"),H=(0,v.Z)(L,Y,G,(function(){return $.apply(this,arguments)})),Q=H.image,W=H.setImage,q=H.progress,z=H.handleSelectImage,X=H.handleDeleteImage;function $(){return($=(0,a.Z)(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null===e||void 0===e?void 0:e.role)===_.xZ.ADMIN){t.next=3;break}return A().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 3:return r=(0,x.JU)(g.db,"users",n),t.next=6,(0,x.r7)(r,{avatar:""});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,j.useEffect)((function(){W(B)}),[B,W]);var ee=F("hot"),te=F("status");(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return t=(0,x.JU)(g.db,"posts",n),e.next=5,(0,x.QT)(t);case 5:(r=e.sent).data()&&(J(r.data()),se((null===(a=r.data())||void 0===a?void 0:a.category)||""),N((null===(s=r.data())||void 0===s?void 0:s.content)||""));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,J]);var ne=(0,j.useState)(""),re=(0,s.Z)(ne,2),ae=re[0],se=re[1],ie=(0,j.useState)([]),oe=(0,s.Z)(ie,2),ce=oe[0],ue=oe[1];(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,x.hJ)(g.db,"categories"),n=(0,x.IO)(t,(0,x.ar)("status","==",1)),e.next=4,(0,x.PL)(n);case 4:a=e.sent,s=[],a.forEach((function(e){s.push((0,r.Z)({id:e.id},e.data()))})),ue(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var le=function(){var e=(0,a.Z)(o().mark((function e(t){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,x.JU)(g.db,"categories",t.id),e.next=3,(0,x.QT)(n);case 3:a=e.sent,L("category",(0,r.Z)({id:a.id},a.data())),se(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){var t=(0,a.Z)(o().mark((function t(a){var s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(K){t.next=2;break}return t.abrupt("return");case 2:if((null===e||void 0===e?void 0:e.role)===_.xZ.ADMIN){t.next=5;break}return A().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 5:return s=(0,x.JU)(g.db,"posts",n),a.status=Number(a.status),a.slug=T()(a.slug||a.title,{lower:!0}),t.next=10,(0,x.r7)(s,(0,r.Z)((0,r.Z)({},a),{},{image:Q,content:Z}));case 10:S.Am.success("Update post successfully!");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),pe=(0,j.useMemo)((function(){return{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"]],imageUploader:{upload:function(){var e=(0,a.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("upload: ~ file",t),n=new FormData,console.log("upload: ~ bodyFormData",n),n.append("image",t),e.next=6,C()({method:"post",url:D,data:n,headers:{"Content-Type":"multipart/form-data"}});case 6:return r=e.sent,e.abrupt("return",r.data.data.url);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}}),[]);return n?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(b.Z,{title:"Update post",desc:"Update post content"}),(0,O.jsxs)("form",{onSubmit:U(de),children:[(0,O.jsxs)("div",{className:"form-layout",children:[(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Title"}),(0,O.jsx)(h.I,{control:R,placeholder:"Enter your title",name:"title",required:!0})]}),(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Slug"}),(0,O.jsx)(h.I,{control:R,placeholder:"Enter your slug",name:"slug"})]})]}),(0,O.jsxs)("div",{className:"form-layout",children:[(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Image"}),(0,O.jsx)(p.Z,{onChange:z,handleDeleteImage:X,className:"h-[250px]",progress:q,image:Q})]}),(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Category"}),(0,O.jsxs)(l.L,{children:[(0,O.jsx)(l.L.Select,{placeholder:"Select the category"}),(0,O.jsx)(l.L.List,{children:ce.length>0&&ce.map((function(e){return(0,O.jsx)(l.L.Option,{onClick:function(){return le(e)},children:e.name},e.id)}))})]}),(null===ae||void 0===ae?void 0:ae.name)&&(0,O.jsx)("span",{className:"inline-block p-3 text-sm font-medium text-green-600 rounded-lg bg-green-50",children:null===ae||void 0===ae?void 0:ae.name})]})]}),(0,O.jsx)("div",{className:"mb-10",children:(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Content"}),(0,O.jsx)("div",{className:"w-full entry-content",children:(0,O.jsx)(w(),{modules:pe,theme:"snow",value:Z,onChange:N})})]})}),(0,O.jsxs)("div",{className:"form-layout",children:[(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Feature post"}),(0,O.jsx)(m.Z,{on:!0===ee,onClick:function(){return L("hot",!ee)}})]}),(0,O.jsxs)(d.g,{children:[(0,O.jsx)(f._,{children:"Status"}),(0,O.jsxs)(d.Y,{children:[(0,O.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===_.cf.APPROVED,value:_.cf.APPROVED,children:"Approved"}),(0,O.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===_.cf.PENDING,value:_.cf.PENDING,children:"Pending"}),(0,O.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===_.cf.REJECTED,value:_.cf.REJECTED,children:"Reject"})]})]})]}),(0,O.jsx)(c.z,{type:"submit",className:"mx-auto w-[250px]",isLoading:M,disabled:M,children:"Update post"})]})]}):null}}}]);
//# sourceMappingURL=299.c8de9a2a.chunk.js.map